### 镜像(Image)
镜像 : 一个只读的模板

镜像可以用来创建容器

### 容器
docker 利用容器(container) 来运行应用.

容器是从镜像创建的运行实例。它可以被启动、开始、停止、删除。每个容器都是相互隔离的，保证安全的平台。

> 镜像是只读的，容器在启动的时候创建一层可写层作为最上层.

### 仓库
仓库(repository)是集中存放镜像文件的场所。
有时候会把仓库和仓库注册服务器(registry)混为一谈，并不严格区分.

实际上, 仓库注册服务器上往往存放着多个仓库, 每个仓库中又包含了多个镜像，每个镜像有不同的标签(tag)

仓库分为公开仓库(public) 和 私有仓库(private)

最大的公开仓库是 docker hub, 存放了数量庞大的镜像供用户下载。

国内的镜像包括 时速云、网易云等

> docker 仓库的概念跟 git 类似, 注册服务器可以理解为 github 这样的托管服务.

### 获取镜像
可以使用 `docker pull` 命令从仓库获取所需要的镜像。
> 这条命令相当于 hub.docker.com/ubuntu:12.04 ,即从默认的注册服务器(hub.docker.com) 中的 ubuntu
仓库里的 tag 是 12.04 的下载下来

有时候官方仓库注册服务器下载慢，可以用国内的仓库下载，需要指定完整的仓库注册服务器地址, 如下:
docker pull daocloud.io/library/nginx
> daocloud.io/library 是国内的镜像注册服务器地址  nginx 是仓库

### 列出本地镜像
 - `docker images` 显示本地已有的镜像，或者 `docker image list`
    + REPOSITORY: 仓库地址
    + TAG: 仓库地址的 tag 标签
    + IMAGE ID: 镜像ID(唯一)
    + CREATED: 镜像创建时间
    + SIZE: 镜像大小
    
### docker run 主要参数详解
Usage: docker run \[OPTIONS\] IMAGE \[COMMAND\] \[ARG...\]
 - `-d`  --detach=false 指定容器运行于前台还是后台; 带上此参数，表明容器运行于后台
 - `-e` `--env=[]`      指定环境变量，容器中可以使用该环境变量
 - `-P` `--publish-all=false` 暴露所有的端口到随机端口
 - `-p` `--publish=[]`  暴露端口到主机
 - `-i` 打开 `STDIN`, 用于控制台交互
 - `--name=` 指定容器的名字, 后续可以通过名字进行容器管理, `links`特性需要使用名字
 - `-v` 给容器挂载存储卷, 挂载到容器的某个目录
 - `-w` `--workdir=` 指定容器的工作目录
 - `-t`  分配 tty 设备, 可以支持终端登录
 - `-h` `--hostname=` 指定容器的主机名
#### -i -t 让容器实现对话功能
docker run  -i -t ubuntu:12.04 /bin/bash
`-t`: 在新容器内指定一个伪终端或终端
`-i`: 允许你对容器内的标准输入(`STDIN`) 进行交互
#### -d 让容器后台运行
#### --name= 给容器起一个名字

###  在宿主机内 `docker logs container` 查看容器的标准输出
### `docker stop containerID` 来停止容器
### `docker start containerID` 启动一个以经停止的容器
### `docker restart containerID` 对一个容器重启

### 进入容器
在使用 `-d` 参数时, 容器启动后会进入后台, 此时想要进入容器可以通过以下指令进入:
 - docker attach
    `docker attach 容器id`; 容过这个容器退出, 会导致容器的停止,比如在容器中 运行 exit指令
 - docker exec:
    docker exec -it containerID \[arg...\]; 这样在容器内运行 exit 也不会停止容器
    
    
### 导出和导入容器
#### 导出容器
`docker export containerID > path/file_name.tar`
#### 导入容器
`cat container_export_name.tar | docker import - wanmei002/ubuntu:v1.0`
### 删除容器
`docker rm -f containerID/cName `: 
  `-f` 强行删除

`docker container prune` : 清理掉所有处于终止状态的容器
> 删除容器，容器必须是停止状态

### 删除镜像
`docker rmi hello-world`

### 创建镜像
#### 从已创建的容器中更新镜像，并且提交这个镜像
 1. 使用镜像来创建一个容器
 2. 对这个容器做一些修改
 3. 使用 commit 来提交容器副本

例如:

 `docker run -t -i ubuntu:15.10 /bin/bash`
 
 进入容器后: `apt-get update`
 
 `exit` 退出容器
 
 `docker commit -m="just update" -a="wanmei002" containerID wanmei002/ub2:v2`


#### 使用 dockerfile 指令来创建一个新的镜像
 1. 创建一个 dockerfile 文件
    - FROM IMAGE_NAME 是基于哪个镜像的
    - RUN 指令告诉 docker 在镜像内执行命令
 2. `docker build -t wanmei002/ubt2:v1.1 .`
    - `-t`: 指定要创建的目标镜像名
    - `.`: Dockerfile 文件所在目录, 可以指定 `Dockerfile` 的绝对路径
    
### 设置镜像标签
 `docker tag IMAGE_ID wanmei002/ubt2:dev`
 
 `IMAGE_ID` : 镜像ID
 `wanmei002/ubt2:dev`: 镜像名`:`镜像tag



### 提交容器
在容器有变动的时候，想生成一个版本，可以用以下命令:
`docker commit -m="add info" -a="作者" containerID wanmei002/ub1:v1.0`

`-m`: 提交的描述信息
`-a`: 指定镜像作者
`containerID`: 容器id
`wanmei002/ub1:v1.0` : 指定要创建的目标镜像名:tag


### `docker ps` 查看正在运行的容器 
返回的字段简单介绍
 - CONTAINER ID: 容器ID
 - IMAGE: 使用的镜像
 - CREATED: 容器的创建时间
 - STATUS: 容器状态
 - PORTS: 容器的端口信息和使用的连接类型(tcp/udp)
 - NAMES: 自动分配的容器名称

docker ps -a 查看所有容器的命令包括以经停止/退出的容器
### 容器退出
#### 在容器内
exit;

ctrl+d
#### 在容器外
docker stop container(容器id 或 容器名)

docker kill container(容器id 或 容器名)

### docker 容器连接
#### 容器联网
 - 查看可用的网络:
    `docker network ls`
 - 新建网络
    `docker create -d bridge test-net`;
    `-d`: 参数指定 docker 网络类型, 有 `bridge`、`overlay`;其中 overlay 网络类型用于 swarm mode, 在本小节中你可以或略它
#### 容器连接同一个 docker 网络
 





### docker 后台运行和进入后台运行的容器
先创建并进入一个新的被命名为newos的新容器    docker run -it --name newos docker.io/centos   

> 创建并指定端口号映射 docker run -d -p 8002:80 --name my_ng nginx/centos /bin/bash   启动的时候用 /bin/bash可能到时下一次无法启动 可以改成tail -f /var/log/nginx/error.log等前台运行的命令

docker run -it -p 8001:80 --name nginx01 -h nginx ng1 /bin/bash （不用-d参数 也不能直接nginx把ng启动在后台 这样都没法启动容器  用/bin/bash先进入在ctrl p d 放在后台）

Ctrl + P + Q 退出容器保持后台运行（按住ctrl和P 再按Q），再用 docker ps 进行查看：  exit可以直接退出容器

再次进入一个正在运行的容器

docker attach dreamy_ritchie或者用ID 

还有更好的,上面的attach经常会卡主不动

docker exec -it ContainerName /bin/bash  上面用attach进入的用exit会退出容器必须用ctrl P Q退出才能继续后台运行，exec的 用exit也不会真正退出容器继续后台运行  用name或id都可以

docker exec -it ContainerName Command 是执行完命令就退出放在后台比如 ps -ef 显示内容然后就退出前台  如果要进入容器就用/bin/bash

前提是容器要正在运行   如果不是running就先 docker start containername
 



