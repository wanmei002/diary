### redis 过期时间的判定
在Redis内部，每当我们设置一个键的过期时间时，
Redis就会将该键带上过期时间存放到一个过期字典中。
当我们查询一个键时，Redis便首先检查该键是否存在过期字典中，
如果存在，那就获取其过期时间。然后将过期时间和当前系统时间进行比对，
比系统时间大，那就没有过期；反之判定该键过期。

### redis 过期删除策略
redis 过期删除策略: 惰性删除和定期删除两种策略配合使用

#### 惰性删除
Redis的惰性删除策略由 db.c/expireIfNeeded 函数实现，
所有键读写命令执行之前都会调用 expireIfNeeded 函数对其进行检查，
如果过期，则删除该键，然后执行键不存在的操作；未过期则不作操作，继续执行原有的命令

#### 定期删除
由redis.c/activeExpireCycle 函数实现，函数以一定的频率运行，每次运行时，
都从一定数量的数据库中取出一定数量的随机键进行检查，并删除其中的过期键。

定期删除函数的运行频率，在Redis2.6版本中，规定每秒运行10次，大概100ms运行一次。
在Redis2.8版本后，可以通过修改配置文件redis.conf 的 hz 选项来调整这个次数。

>我们看到，通过过期删除策略，对于某些永远使用不到的键，
并且多次定期删除也没选定到并删除，那么这些键同样会一直驻留在内存中，
又或者在Redis中存入了大量的键，这些操作可能会导致Redis内存不够用，
这时候就需要Redis的内存淘汰策略了。

### 内存淘汰策略
 1. 通过参数 maxmemory <bytes> 来设定最大内存
 
 当现有内存大于 maxmemory 时, 便会触发 redis 主动淘汰内存方式, 通过设置 maxmemory-policy 的值:
     1. volatile-lru   利用LRU算法移除设置过过期时间的key (LRU:最近使用 Least Recently Used ) 。
 　  2. allkeys-lru   利用LRU算法移除任何key （和上一个相比，删除的key包括设置过期时间和不设置过期时间的）。通常使用该方式。
 　　3. volatile-random 移除设置过过期时间的随机key 。
     4. allkeys-random  无差别的随机移除。
     5. volatile-ttl   移除即将过期的key(minor TTL) 
 　　6. noeviction 不移除任何key，只是返回一个写错误 ，默认选项，一般不会选用。